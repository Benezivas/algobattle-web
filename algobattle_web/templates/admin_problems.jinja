{% extends "base.jinja" %}
{% block content %}

<script src="/static/scripts/admin_problems.js" type="module"></script>
<script>
  var problems = {{problems | tojson}}
  var configs = {{configs | tojson}}
</script>


<script type="text/x-template" id="problem">
  <div class="accordion-item">
    <h2 class="accordion-header" :id="'heading' + problem.name">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" :data-bs-target="'#collapse' + problem.name" aria-expanded="false" :aria-controls="'collapse' + problem.name">
        ${problem.name}
      </button>
    </h2>
    <div :id="'collapse' + problem.name" class="accordion-collapse collapse" :aria-labelledby="'heading' + problem.name" data-bs-parent="#problems">
      <form class="accordion-body" @submit.prevent="edit">
        <table class="table">
          <tbody>
            <tr>
              <td>Name</td>
              <td>${problem.name}</td>
            </tr>
            <tr>
              <td>File</td>
              <td>
                <input v-if="editing" class="e-em form-control form-control-sm" name="file" type="file">
                <a v-else role="button" class="btn btn-primary btn-sm" :href="'/api/problem/getfile/'+problem.id" data-bs-toggle="tooltip" title="Download config file">${problem.file.name} <i class="bi bi-file-earmark-arrow-down"></i></a>
              </td>
            </tr>
            <tr>
              <td>Config</td>
              <td>${store.configs[problem.config].name}</td>
            </tr>
            <tr v-if="editing || problem.start">
              <td>Start</td>
              <td>${fmt_date(problem.start)}</td>
            </tr>
            <tr v-if="editing || problem.end">
              <td>End</td>
              <td>${fmt_date(problem.end)}</td>
            </tr>
            <tr v-if="editing || problem.description">
              <td>Description</td>
              <td>
                <input v-if="editing" class="e-em form-control form-control-sm" name="file" type="file">
                <a v-else role="button" class="btn btn-primary btn-sm" :href="'/api/problem/getdesc/'+problem.id" data-bs-toggle="tooltip" title="Download config file">
                  ${problem.description.name} <i class="bi bi-file-earmark-arrow-down"></i>
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </form>
    </div>
  </div>
</script>


<div id="app">
  <h3>Problems</h3>
  <div class="accordion" id="problems">
    <Problem v-for="(problem, id) in store.problems" :key="id" :problem="problem"></Problem>
  <div class="accordion-item">
    <h2 class="accordion-header" id="create">
      <button class="accordion-button collapsed bg-success bg-opacity-25" type="button" data-bs-toggle="collapse" data-bs-target="#collapsecreate" aria-expanded="false" aria-controls="collapsecreate">
        Create new problem
      </button>
    </h2>
    <div id="collapsecreate" class="accordion-collapse collapse" aria-labelledby="headingcreate" data-bs-parent="#problems">
      <form class="accordion-body" @submit.prevent="create_problem">
        <table class="table">
          <tbody>
            <tr>
              <td>Name</td>
              <td>
                <input class="form-control form-control-sm" name="name" type="text" required="required">
              </td>
            </tr>
            <tr>
              <td>File</td>
              <td>
                <input class="form-control form-control-sm" name="file" type="file" required="required">
              </td>
            </tr>
            <tr>
              <td>Config</td>
              <td>
                <select class="form-select form-select-sm" name="config">
                  <option v-for="(config, id) in store.configs" :value="id">${config.name}</option>
                </select>
              </td>
            </tr>
            <tr>
              <td>Start</td>
              <td>
                <input class="form-control form-control-sm" name="start" type="datetime-local">
              </td>
            </tr>
            <tr>
              <td>End</td>
              <td>
                <input class="form-control form-control-sm" name="end" type="datetime-local">
              </td>
            </tr>
            <tr>
              <td>Description</td>
              <td>
                <input class="form-control form-control-sm" name="description" type="file">
              </td>
            </tr>
          </tbody>
        </table>
        <button type="submit" class="btn btn-primary mt-3">Create</button>
      </form>
    </div>
  </div>
  </div>


{% endblock %}
