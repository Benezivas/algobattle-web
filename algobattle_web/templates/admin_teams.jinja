{% extends "base.jinja" %}
{% block content %}

<script src="/static/scripts/admin_teams.js" type="module"></script>
<script>
  var teams_input = {{teams | tojson}}
  var contexts_input = {{contexts | tojson}}
  var users_input = {{users | tojson}}
</script>


<script type="text/x-template" id="team_row">
  <tr>
    <td>
      <input v-if="editing" class="form-control form-control-sm" name="name" type="text" :placeholder="team.name">
      <span v-else>${team.name}</span>
    </td>
    <td>
      <select v-if="editing" class="form-select form-select-sm" name="context">
        <option v-for="(ctx, id) in store.contexts" :value="id" :selected="id == team.context">${ctx.name}</option>
      </select>
      <span v-else>${store.contexts[team.context].name}</span>
    </td>
    <td><span>${members_str()}</span></td>
    <td class="text-end">
      <div class="btn-group btn-group-sm" role="group">
        <button type="button" class="btn btn-danger" data-bs-toggle="tooltip" title="Delete team" v-if="editing" @click="delete_team"><i class="bi bi-trash"></i></button>
        <button type="button" class="btn btn-warning" data-bs-toggle="tooltip" title="Edit team" @click="toggle_editing"><i class="bi bi-pencil"></i></button>
        <button type="submit" class="btn btn-success" data-bs-toggle="tooltip" title="Submit edit" v-if="editing"><i class="bi bi-check2"></i></button>
      </div>
    </td>
  </tr>
</script>

<script type="text/x-template" id="context_row">
  <tr>
    <td>
      <input v-if="editing" class="form-control form-control-sm" name="name" type="text" :placeholder="context.name">
      <span v-else>${context.name}</span>
    </td>
    <td class="text-end">
      <div class="btn-group btn-group-sm" role="group">
        <button type="button" class="btn btn-danger" data-bs-toggle="tooltip" title="Delete team" v-if="editing" @click="delete_context"><i class="bi bi-trash"></i></button>
        <button type="button" class="btn btn-warning" data-bs-toggle="tooltip" title="Edit team" @click="toggle_editing"><i class="bi bi-pencil"></i></button>
        <button type="submit" class="btn btn-success" data-bs-toggle="tooltip" title="Submit edit" v-if="editing"><i class="bi bi-check2"></i></button>
      </div>
    </td>
  </tr>
</script>


<div id="app">
  <h3>Teams</h3>
  <form id="team-table" @submit.prevent="edit_team" class="mb-5">
    <table class="table" id="teams">
      <thead>
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Context</th>
          <th scope="col">Members</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <tr is="vue:team-row" v-for="(team, id) in store.teams" :team="team" :key="id"></tr>
      </tbody>
    </table>
  </form>

  <h3>Create new team</h3>
  <form id="create-team" @submit.prevent="create_team" class="mb-5">
    <div class="row g-2">
      <div class="col-md w-em">
        <label for="name" class="form-label">Name</label>
        <input class="form-control form-control-sm" name="name" type="text" required="required">
      </div>
      <div class="col-md w-em">
        <label for="context-select" class="form-label">Context</label>
        <select class="form-select form-select-sm" id="context-select" name="context">
          <option v-for="(context, id) in store.contexts" :value="id">${context.name}</option>
        </select>
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Create</button>
  </form>

  <h3>Edit team membership</h3>
  <div class="row g-2">
    <div class="col-md w-em">
      <label for="team" class="form-label">Team</label>
      <select class="form-select form-select-sm" name="team" required="required" v-model="edit_team_member_team">
        <option v-for="(team, id) in store.teams" :value="id">${team.name}</option>
      </select>
    </div>
    <div class="col-md w-em">
      <label for="user-select" class="form-label">User</label>
      <select class="form-select form-select-sm" id="user-select" name="user" v-model="edit_team_member_user">
        <option v-for="(user, id) in store.users" :value="id">${user.name}</option>
      </select>
    </div>
  </div>
  <button class="btn btn-success mt-3 mb-3 me-2" @click="add_member">Add Member</button>
  <button class="btn btn-danger mt-3 mb-3" @click="remove_member">Remove Member</button>

  <div class="row gy-5">
    <div class="col-md w-em">
      <h3>Contexts</h3>
      <form id="team-table" @submit.prevent="edit_context">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Name</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
            <tr is="vue:context-row" v-for="(context, id) in store.contexts" :context="context" :key="id"></tr>
          </tbody>
        </table>
    </form>
    </div>
    <div class="col-md">
      <h3>Create new context</h3>
      <form id="create-context" @submit.prevent="create_context">
        <label for="name" class="form-label">Name</label>
        <input class="form-control form-control-sm w-em mb-3" name="name" type="text" required="required">
        <button type="submit" class="btn btn-primary">Create</button>
    </form>
    </div>
  </div>
</div>


{% endblock %}
